import{h,c as p,g as j,r as u,A as y,j as e,D as C,R as x,U,u as P,d as S,f}from"./index-5jvPL8OW.js";import{P as k}from"./Pagination-kxgyjZLV.js";import{C as A}from"./ConfirmDialog-mGbK-3rd.js";import{T as M}from"./TrashIcon-YDJyk2b0.js";async function I(t,s){t=t||10,s=s||0;let r=await h.get("/api/v1/user",{params:{limit:t,offset:s}});if(r.status!==200)throw Error("failed to get problem list");return r.data}async function L(t){if((await h.delete(`/api/v1/user/${t}`)).status!==200)throw Error("failed to delete user")}async function D(t,s,r){r||(r="system");let a=JSON.stringify({role:s,domain:r});if((await h.post(`/api/v1/user/${t}/role`,a)).status!==200)throw Error("failed to grant user role")}async function E(t,s,r){r||(r="system");let a=JSON.stringify({role:s,domain:r});if((await h.delete(`/api/v1/user/${t}/role`,{data:a})).status!==200)throw Error("failed to revoke user role")}const R=()=>{const t=p(),{t:s}=j(),[r,n]=u.useState([]),[a,o]=u.useState(0),[c,i]=u.useState(10),[d,g]=u.useState(0);u.useEffect(()=>{I(c,d).then(l=>{l.list&&n(l.list),l.total&&o(l.total)}).catch(l=>{t({type:y,payload:{id:"user-list-fetch-error",content:`${s("Failed to fetch user list")}`,duration:3e3,level:"error",err:l.toString()}})})},[t,c,d,s]);function b(){return r}function v(l){return Math.ceil(a/l)}function w(l,N){i(l),g(N)}return{getUserInfoList:b,getPageCount:v,setPagenation:w}},T=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:C,strokeLinecap:"round",strokeLinejoin:"round",className:t.className,children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0"}),e.jsx("path",{d:"M6 21v-2a4 4 0 0 1 4 -4h2.5"}),e.jsx("path",{d:"M19.001 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"}),e.jsx("path",{d:"M19.001 15.5v1.5"}),e.jsx("path",{d:"M19.001 21v1.5"}),e.jsx("path",{d:"M22.032 17.25l-1.299 .75"}),e.jsx("path",{d:"M17.27 20l-1.3 .75"}),e.jsx("path",{d:"M15.97 17.25l1.3 .75"}),e.jsx("path",{d:"M20.733 20l1.3 .75"})]}),_=t=>{const{t:s}=j(),[r,n]=x.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:t.className,children:e.jsxs("table",{className:"table","aria-label":"Problem Table",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-base-content/10",children:[e.jsx("th",{children:s("Avatar")},"avatar"),e.jsx("th",{children:s("Name")},"name"),e.jsx("th",{children:s("Account")},"account"),e.jsx("th",{children:s("Roles")},"roles"),t.showActions&&e.jsx("th",{children:s("Actions")},"actions")]})}),e.jsx("tbody",{children:t.data.map(a=>e.jsxs("tr",{className:"border-base-content/10",children:[e.jsx("td",{className:"flex items-center gap-3 py-2",children:e.jsx("div",{className:"avatar",children:e.jsx(U,{alt:a.name,avatarUrl:a.avatarUrl})})}),e.jsx("th",{children:a.name}),e.jsx("td",{children:a.account}),e.jsx("td",{children:e.jsx($,{roles:a.roles??[]})}),t.showActions&&e.jsx("td",{className:"p-2",children:e.jsx(F,{userInfo:a,onClickDelete:()=>{n(a.account)}})})]},a.account))})]})}),e.jsx(A,{id:"user_delete_confirm_modal",title:"Confirm",message:s("Are you sure to delete this user?"),onClickConfirm:()=>{r&&L(r).then(()=>{window.location.reload()}).catch(a=>{console.error(a)})}})]})},$=t=>t.roles===void 0?e.jsx(e.Fragment,{}):e.jsx("div",{className:"space-x-2",children:t.roles.map(s=>e.jsx("div",{className:"badge border-0 bg-base-300 font-semibold text-base-content/80",children:s},s))}),F=t=>{var n,a,o;const s=P(S),r=c=>{c.preventDefault(),c.stopPropagation(),t.onClickDelete();const i=document.getElementById("user_delete_confirm_modal");i==null||i.showModal()};return e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{className:f("btn btn-square btn-ghost btn-sm rounded",(((n=t.userInfo.roles)==null?void 0:n.includes("super"))||t.userInfo.account===(s==null?void 0:s.account))&&"btn-disabled"),onClick:()=>{var c,i;(c=t.userInfo.roles)!=null&&c.includes("admin")?E(t.userInfo.account,"admin").catch(d=>{console.error(d)}):(i=t.userInfo.roles)!=null&&i.includes("super")||D(t.userInfo.account,"admin").catch(d=>{console.error(d)}),window.location.reload()},children:e.jsx(T,{className:f("h-5 w-5",(a=t.userInfo.roles)!=null&&a.includes("admin")||(o=t.userInfo.roles)!=null&&o.includes("super")?"text-success":"text-base-content")})}),e.jsx("button",{className:"btn btn-square btn-ghost btn-sm rounded hover:bg-error/20",onClick:r,children:e.jsx(M,{className:"h-5 w-5 text-error"})})]})},m=[10,25,50],W=()=>{const{getUserInfoList:t,getPageCount:s,setPagenation:r}=R(),[n,a]=x.useState(m[0]),[o,c]=x.useState(0);return u.useEffect(()=>{r(n,o*n)},[n,o,r]),e.jsxs("div",{className:"card card-bordered flex w-full flex-col rounded border-base-content/10 bg-base-100",children:[e.jsx(_,{data:t(),showActions:!0,className:t().length===1?"":"border-b border-base-content/10"}),e.jsx(k,{page:o,pageCount:s(n),setCountPerPage:a,countPerPage:n,countPerPageSelections:m,setPage:c})]})};export{W as default};
